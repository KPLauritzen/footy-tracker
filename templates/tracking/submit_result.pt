<div metal:use-macro="load: ../shared/_layout.pt">
    <div metal:fill-slot="content" tal:omit-tag="True">

    <div class="content">

        <div class="section">
        <div class="form-container">
        <form action="" method="POST" class="account-form">
            <h1 class="title">Register a match result</h1>
            <br><br>
            <div class="columns">
                <div class="column">
                    <h1 class="title">Team 1</h1>
                    <div class="field">
                        <label class="label">Goals</label>
                        <div class="control has-icons-left has-icons-right">
                            <input class="input" type="text" placeholder="Goals for team 1" id="goals-team1">
                            <span class="icon is-small is-left">
                              <ion-icon name="football"></ion-icon>
                            </span>
                            <span class="icon is-small is-right is-hidden">
                              <ion-icon name="checkmark" id="goals-team1-status-icon"></ion-icon>
                            </span>
                            <p class="help is-danger is-hidden" id="goals-team1-warning-text">Number of goals must be a positive integer</p>
                        </div>
                    </div>


                    <div class="field">
                        <label class="label">Defender</label>
                        <div class="control has-icons-left">
                            <div class="select">
                                <select id="defender-team1">
                                    <option value="">Select team 1 defender</option>
                                    <option value="Jes">Jes</option>
                                    <option value="Nanna">Nanna</option>
                                    <option value="lol">lol</option>
                                    <option value="lols">lols</option>
                                </select>
                            </div>
                            <span class="icon is-small is-left">
                                <ion-icon name="person"></ion-icon>
                            </span>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Attacker</label>
                        <div class="control">
                            <div class="control has-icons-left">
                                <div class="select">
                                    <select id="attacker-team1">
                                        <option value="">Select team 1 attacker</option>
                                        <option value="Jes">Jes</option>
                                        <option value="Nanna">Nanna</option>
                                        <option value="lol">lol</option>
                                        <option value="lols">lols</option>
                                    </select>
                                </div>
                                <span class="icon is-small is-left">
                                    <ion-icon name="person"></ion-icon>
                                </span>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="column">
                    <h1 class="title">Team 2</h1>
                    <div class="field">
                        <label class="label">Goals</label>
                        <div class="control has-icons-left has-icons-right">
                            <input class="input" type="text" placeholder="Goals for team 2" id="goals-team2">
                            <span class="icon is-small is-left">
                              <ion-icon name="football"></ion-icon>
                            </span>
                            <span class="icon is-small is-right is-hidden">
                              <ion-icon name="checkmark" id="goals-team2-status-icon"></ion-icon>
                            </span>
                            <p class="help is-danger is-hidden" id="goals-team2-warning-text">Number of goals must be a positive integer</p>
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">Defender</label>
                        <div class="control has-icons-left">
                            <div class="select">
                                <select id="defender-team2">
                                    <option value="">Select team 2 defender</option>
                                    <option value="Jes">Jes</option>
                                    <option value="Nanna">Nanna</option>
                                    <option value="lol">lol</option>
                                    <option value="lols">lols</option>
                                </select>
                            </div>
                            <span class="icon is-small is-left">
                                <ion-icon name="person"></ion-icon>
                            </span>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Attacker</label>
                        <div class="control has-icons-left">
                            <div class="select">
                                <select id="attacker-team2">
                                    <option value="">Select team 2 attacker</option>
                                    <option value="Jes">Jes</option>
                                    <option value="Nanna">Nanna</option>
                                    <option value="lol">lol</option>
                                    <option value="lols">lols</option>
                                </select>
                            </div>
                            <span class="icon is-small is-left">
                                <ion-icon name="person"></ion-icon>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="columns">
            <div class="column">
                <div class="field">
                <div class="control">
                    <button type="submit" class="button is-primary">Submit</button>
                </div>
                </div>
            </div>
            </div>
            </form>
            </div>
        </div>
    </div>
</div>

</div>


<script>
    const goalsTeam1 = document.querySelector('#goals-team1')
    const goalsTeam2 = document.querySelector('#goals-team2')
    const goalsWarningTextTeam1 = document.querySelector('#goals-team1-warning-text')
    const goalsWarningTextTeam2 = document.querySelector('#goals-team2-warning-text')
    const goalStatusIconTeam1 = document.querySelector('#goals-team1-status-icon')
    const goalStatusIconTeam2 = document.querySelector('#goals-team2-status-icon')
    const defenderTeam1Selection = document.querySelector('#defender-team1')
    const attackerTeam1Selection = document.querySelector('#attacker-team1')
    const defenderTeam2Selection = document.querySelector('#defender-team2')
    const attackerTeam2Selection = document.querySelector('#attacker-team2')

    // Partial functions for updating the status of the elements containing goals for team 1 and team 2
    const updateTeam1GoalInputStatus = x => updateGoalInputStatus(x, goalsTeam1, goalsWarningTextTeam1, goalStatusIconTeam1),
            updateTeam2GoalInputStatus = x => updateGoalInputStatus(x, goalsTeam2, goalsWarningTextTeam2, goalStatusIconTeam2);

    // Event listeners to update the status and warning text of the elements containing goals for team 1 and team 2
    goalsTeam1.addEventListener('input', updateTeam1GoalInputStatus);
    goalsTeam2.addEventListener('input', updateTeam2GoalInputStatus);

    defenderTeam1Selection.addEventListener('change', updateDropdownMenus);
    attackerTeam1Selection.addEventListener('change', updateDropdownMenus);
    defenderTeam2Selection.addEventListener('change', updateDropdownMenus);
    attackerTeam2Selection.addEventListener('change', updateDropdownMenus);


    function updateGoalInputStatus(e, goalInputElement, goalWarningTextElement, goalInputStatusIconElement) {
        if (isPositiveInteger(e.target.value)) {
            goalInputElement.classList.remove('is-danger')
            goalInputElement.classList.add('is-success')

            goalWarningTextElement.classList.add('is-hidden')

            goalInputStatusIconElement.parentElement.classList.remove('is-hidden')
            goalInputStatusIconElement.name = "checkmark"

        } else if (e.target.value === "") {
            goalInputElement.classList.remove('is-success')
            goalInputElement.classList.remove('is-danger')

            goalWarningTextElement.classList.add('is-hidden')

            goalInputStatusIconElement.parentElement.classList.add('is-hidden')

        } else {
          goalInputElement.classList.remove('is-success')
          goalInputElement.classList.add('is-danger')

          goalWarningTextElement.classList.remove('is-hidden')
          goalInputStatusIconElement.parentElement.classList.remove('is-hidden')
          goalInputStatusIconElement.name = "warning"
        }
    }


    function updateDropdownMenus(event) {

        // var target = event.target

        /*indexEventDropdown = dropdownMenus.findIndex(x => x.id === target.id)
        dropdownMenus.splice(indexEventDropdown, 1)
*/
        var dropdownMenus = [defenderTeam1Selection, attackerTeam1Selection, defenderTeam2Selection, attackerTeam2Selection]

        for (let i = 0; i < dropdownMenus.length; i++) {

            // Remove all previous is-hidden modifiers
            for (let option of dropdownMenus[i].options) {
                unhide(option)
            }

            // Find user selection in all dropdown menus except the one we are modifying
            var otherDropDownMenus = [...dropdownMenus.slice(0, i), ...dropdownMenus.slice(i + 1, dropdownMenus.length)]

            //console.log(otherDropDownMenus)
            //console.log(i)
            for (let otherDropdownMenu of otherDropDownMenus) {
                // Hide element selected in other dropdown
                if (otherDropdownMenu.options.selectedIndex !== 0) {
                   hide(dropdownMenus[i].options[otherDropdownMenu.options.selectedIndex])
                }
            }
            //for (let l = 0; l < otherDropDownMenus.length; l++)
                //console.log(j)
                //console.log(otherDropDownMenus)
                //console.log(otherDropDownMenus[l])

                // // Remove all previous is-hidden modifiers
                // for (let option of dropdownMenus[i].options) {
                //    unhide(option)
                // }
                // // Hide element selected in other dropdown
                // if (otherDropDownMenus[l].options.selectedIndex !== 0) {
                //    hide(dropdownMenus[i].options[otherDropDownMenus[l].options.selectedIndex])
                // }
        }

/*
        const indexOptionToRemove = event.target.selectedIndex

        // Remove all previous is-hidden modifiers
        for (let option of attackerTeam1Selection.options) {
            unhide(option)
        }
        // Hide element selected in other dropdown
        if (indexOptionToRemove !== 0) {
            hide(attackerTeam1Selection.options[indexOptionToRemove])
        }*/

    }

    function getSelectedIndex(e) {
        e.options.selectedIndex
    }

    function hide(e) {
        e.classList.add('is-hidden')
    }

    function unhide(e) {
        e.classList.remove('is-hidden')
    }

    function isPositiveInteger(str) {
      if (typeof str !== 'string') {
        return false;
      }

      const num = Number(str);

      return Number.isInteger(num) && num > 0;
    }


</script>